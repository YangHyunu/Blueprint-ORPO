# Reasoning Distillation via Analogical Prompting
**ì†Œìˆ˜ì˜ Preference ë°ì´í„°ë¡œ ì¶”ë¡  ê²½ë¡œë¥¼ ì •ë ¬í•˜ëŠ” ê²½ëŸ‰ ìµœì í™” ì „ëµ**

Inspired by [ORPO](https://arxiv.org/abs/2403.07691) & [Analogical Prompting (ICLR 2024)](https://arxiv.org/abs/2310.01714)

<div align="center">

[![Python](https://img.shields.io/badge/Python-3.12+-blue.svg)](https://www.python.org/)
[![Transformers](https://img.shields.io/badge/Transformers-yellow.svg)](https://huggingface.co/docs/transformers/)
[![ORPO](https://img.shields.io/badge/Method-ORPO-green.svg)](https://arxiv.org/abs/2403.07691)
[![Hydra](https://img.shields.io/badge/Config-Hydra-89b4fa.svg)](https://hydra.cc/)
[![Unsloth](https://img.shields.io/badge/Training-Unsloth-f97316.svg)](https://github.com/unslothai/unsloth)

</div>

---

## ëŒ€íšŒ ì†Œê°œ

**ë„¤ì´ë²„ ì»¤ë„¥íŠ¸ì¬ë‹¨ ë¶€ìŠ¤íŠ¸ìº í”„ AI Tech 8ê¸°** â€” Multiple Choice QA

KMMLU, ìˆ˜ëŠ¥í˜• ë¬¸ì œ, KLUE MRC ë“± ë‹¤ì–‘í•œ í•œêµ­ì–´ ë²¤ì¹˜ë§ˆí¬ì—ì„œ **ê³ ë‚œì´ë„ ë‹¤ë‹¨ê³„ ì¶”ë¡  ë¬¸ì œ**ì˜ ì •ë‹µë¥ ì„ ë†’ì´ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.

- **Task**: ì£¼ì–´ì§„ ë¬¸ì œì™€ ì„ ì§€ì—ì„œ ì •ë‹µì„ ì„ íƒí•˜ëŠ” Multiple Choice QA
- **Evaluation Metric**: Accuracy, F1
- **Team Repository**: (ë§í¬)

### Result

| ë¦¬ë”ë³´ë“œ | EM Score |
|----------|----------|
| 200 ORPO Pairs | **+14ë¬¸ì œ(â‰ˆ +3.27%p)** on ìˆ˜ëŠ¥ 425ë¬¸í•­ |

> ì´ í”„ë¡œì íŠ¸ëŠ” ìœ„ ëŒ€íšŒì—ì„œ **Qwen3-14Bì˜ ì¶”ë¡  ì„±ëŠ¥ ìµœì í™”**ë¥¼ ìœ„í•´ ê°œë°œí•œ Reasoning Alignment ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

---

## ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [ë¬¸ì œ ì •ì˜: ì™œ Reasoning Alignmentì¸ê°€](#2-ë¬¸ì œ-ì •ì˜-ì™œ-reasoning-alignmentì¸ê°€)
3. [ì™œ SFTê°€ ì•„ë‹Œê°€](#3-ì™œ-sftê°€-ì•„ë‹Œê°€)
4. [ë°©ë²•ë¡ : Preference-based Reasoning Alignment](#4-ë°©ë²•ë¡ -preference-based-reasoning-alignment)
5. [ì‹¤í—˜ ê²°ê³¼](#5-ì‹¤í—˜-ê²°ê³¼)
6. [Key Findings](#6-key-findings)
7. [ë¹ ë¥¸ ì‹œì‘](#7-ë¹ ë¥¸-ì‹œì‘)
8. [ì°¸ê³  ìë£Œ](#8-ì°¸ê³ -ìë£Œ)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” **í•œêµ­ì–´ ìˆ˜ëŠ¥í˜• ë‹¤ë‹¨ê³„ ì¶”ë¡  ë¬¸ì œ**ì—ì„œ Qwen3 ì‹œë¦¬ì¦ˆì˜ ì„±ëŠ¥ í•œê³„ë¥¼ ë¶„ì„í•˜ê³ ,
ì´ë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ **Reasoning Distillation via Analogical Prompting**ì„ ì ìš©í•œ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

í•µì‹¬ ì•„ì´ë””ì–´ëŠ” ë‹¨ìˆœí•©ë‹ˆë‹¤:

> ì •ë‹µì´ë‚˜ ì§€ì‹ ìì²´ë¥¼ ì¦ë¥˜í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼,
> **ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì¶”ë¡  ê²½ë¡œ(Reasoning Path)ë¥¼ ì •ë ¬(alignment)í•˜ëŠ” ê²ƒ**.

### 1.1 TL;DR

- 200 ORPO Preference Pairs â†’ Upstage ìˆ˜ëŠ¥(425ë¬¸í•­)ì—ì„œ **+14ë¬¸ì œ(â‰ˆ +3.27%p)** ì¶”ê°€ ì •ë‹µ
- Qwen3â€‘14Bâ€‘ORPOê°€ **Qwen3â€‘30Bâ€‘A3Bâ€‘Instructì™€ ë™ê¸‰ ë˜ëŠ” ìš°ìˆ˜**í•œ ê³¼ëª©ë³„ ì„±ëŠ¥ ë‹¬ì„±

### 1.2 í•µì‹¬ ìš”ì•½

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì…ë ¥** | Teacher(Geminiâ€‘3â€‘Flash)ë¡œë¶€í„° ì„ ë³„í•œ Hard Negatives (200ê°œ) |
| **ë°©ë²•** | Teacherì˜ ì¶”ë¡  ê²½ë¡œ ì „ì´(Analogical Prompting) + ORPOë¡œ Decision Boundaryë§Œ êµ­ì†Œ ì •ë ¬ |
| **ì˜ë¯¸** | ì†Œìˆ˜ì˜ Preference ë°ì´í„°ë§Œìœ¼ë¡œ ë„ë©”ì¸ ë§ì¶¤ ì„±ëŠ¥ ê°œì„  ê°€ëŠ¥ (SFT ë¶ˆí•„ìš”) |

### 1.3 Repository Architecture

ëª¨ë…¸ë ˆí¬ êµ¬ì¡°ì´ë©°, `feature/ver-3` ë¸Œëœì¹˜ê°€ ë©”ì¸ í—ˆë¸Œ ì—­í• ì„ í•©ë‹ˆë‹¤.

| Module | ì—­í•  | README |
|--------|------|--------|
| **seed-data** | ì‹œë“œ ë¬¸í•­ ìˆ˜ì§‘ ë° Hard Negative ìƒì„± | [ìƒì„¸ ë¬¸ì„œ](./seed-data/README.md) |
| **preference-data** | Analogical Prompting ê¸°ë°˜ ë°ì´í„° ì¦ê°• | [ìƒì„¸ ë¬¸ì„œ](./preference-data/README.md) |
| **orpo-train** | ORPO í•™ìŠµ íŒŒì´í”„ë¼ì¸ (Hydra ì„¤ì •) | [ìƒì„¸ ë¬¸ì„œ](./orpo-train/README.md) |
| **eda** | train, testì…‹ EDA | [ìƒì„¸ ë¬¸ì„œ](./eda/README.md) |

---

## 2. ë¬¸ì œ ì •ì˜: ì™œ Reasoning Alignmentì¸ê°€

### 2.1 ê´€ì°°ëœ ë¬¸ì œ

Qwen3 ì‹œë¦¬ì¦ˆëŠ” ë‹¨ì¼ ì‚¬ì‹¤(fact) ì§ˆë¬¸ì—ì„œëŠ” ë†’ì€ ì •í™•ë„ë¥¼ ë³´ì´ì§€ë§Œ,
ì—¬ëŸ¬ ì •ë³´ë¥¼ ì—°ê²°í•´ì•¼ í•˜ëŠ” **ë³µí•© ì¸ê³¼Â·ë‹¨ê³„ì  ì¶”ë¡  ë¬¸ì œ**ì—ì„œëŠ” ì¼ê´€ë˜ê²Œ ì„±ëŠ¥ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤.
íŠ¹íˆ í•œêµ­ì‚¬, ì—­ì‚¬, ì‹¬ë¦¬, ê²½ì œ ê³„ì—´ì—ì„œ ë‘ë“œëŸ¬ì§‘ë‹ˆë‹¤.

### 2.2 Core Insight

2025ë…„ ê¸°ì¤€ LLMì€ ì´ë¯¸ ì¶©ë¶„í•œ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.
ë¬¸ì œëŠ” *ë¬´ì—‡ì„ ì•„ëŠ”ê°€*ê°€ ì•„ë‹ˆë¼, **ê·¸ ì§€ì‹ì„ ì–´ë–¤ ìˆœì„œì™€ ê¸°ì¤€ìœ¼ë¡œ ì—°ê²°í•˜ëŠ”ê°€**ì…ë‹ˆë‹¤.

> ì¦‰, ì„±ëŠ¥ ì €í•˜ì˜ ì›ì¸ì€ ì§€ì‹ ë¶€ì¡±ì´ ì•„ë‹ˆë¼
> **ì¶”ë¡  ê²½ë¡œ(Reasoning Path)ì˜ ì •ë ¬ ì‹¤íŒ¨**ì— ìˆìŠµë‹ˆë‹¤.

---

## 3. ì™œ SFTê°€ ì•„ë‹Œê°€

Supervised Fine-Tuning(SFT)ì´ ê°€ì¥ ì§ê´€ì ì¸ í•´ê²°ì±…ì´ì§€ë§Œ,
ì´ë¯¸ ì¶©ë¶„íˆ í•™ìŠµëœ ëª¨ë¸ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìœ„í—˜ì´ ë”°ë¦…ë‹ˆë‹¤.

| ìœ„í—˜ ìš”ì†Œ | ì„¤ëª… |
|-----------|------|
| **Distribution Collapse** | ì†ŒëŸ‰ ë°ì´í„°ë¡œ ì¸í•œ ì¶œë ¥ ë¶„í¬ ì™œê³¡ |
| **Catastrophic Forgetting** | ê¸°ì¡´ ì¶”ë¡  ëŠ¥ë ¥ ì†ì‹¤ |
| **ì¶”ë¡  í’ˆì§ˆ ì €í•˜** | Thinking / Non-Thinking í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë¸ì—ì„œ íŠ¹íˆ ë‘ë“œëŸ¬ì§ |

ì´ëŸ¬í•œ ì´ìœ ë¡œ SFT ëŒ€ì‹ ,
**ê¸°ì¡´ ë¶„í¬ë¥¼ ìœ ì§€í•˜ë©´ì„œ ì¶”ë¡  ê²½ë¡œë§Œ ì„ íƒì ìœ¼ë¡œ ì •ë ¬í•˜ëŠ” ë°©ì‹**ì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤.

---

## 4. ë°©ë²•ë¡ : Preference-based Reasoning Alignment

**ORPO(Odds Ratio Preference Optimization)** ê¸°ë°˜ Preference Learningì„ í™œìš©í•©ë‹ˆë‹¤.
ëª¨ë¸ì˜ ê¸°ì¡´ ë¶„í¬ë¥¼ ë³´ì¡´í•˜ë©´ì„œ, ì˜¬ë°”ë¥¸ ì¶”ë¡  ê²½ë¡œëŠ” ê°•í™”í•˜ê³  ì˜ëª»ëœ ì¶”ë¡  ê²½ë¡œëŠ” ì–µì œí•©ë‹ˆë‹¤.

### 4.1 ì „ì²´ íŒŒì´í”„ë¼ì¸

```
Teacher(Gemini-3-Flash)            Student(Qwen3-14B)
        â”‚                                  â”‚
        â”œâ”€â”€ ì„±ê³µ ì¶”ë¡  ê²½ë¡œ (Golden Path)     â”œâ”€â”€ ì‹¤íŒ¨ ì¶”ë¡  ê²½ë¡œ (Failed Path)
        â”‚                                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë¹„êµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
              Hard Negative ì„ ë³„
                       â”‚
            Analogical Promptingìœ¼ë¡œ ì¦ê°•
                       â”‚
              ORPOë¡œ Student í•™ìŠµ
```

### 4.2 Key Components

| ë‹¨ê³„ | ì—­í•  |
|------|------|
| **Hard Negative Mining** | TeacherëŠ” ì„±ê³µí–ˆìœ¼ë‚˜ StudentëŠ” ì‹¤íŒ¨í•œ ë¬¸ì œë§Œ ì„ íƒì ìœ¼ë¡œ ì‚¬ìš© |
| **Logical Structure Extraction** | ì‹œë“œ ë¬¸í•­ì—ì„œ ë„ë©”ì¸ ë…ë¦½ì ì¸ ì¶”ë¡  êµ¬ì¡° ì¶”ì¶œ |
| **Analogical Prompting** | ì¶”ë¡  êµ¬ì¡°ë¥¼ ìƒˆë¡œìš´ ë„ë©”ì¸Â·ë§¥ë½ìœ¼ë¡œ ì „ì´ |
| **ORPO-based Alignment** | Chosen / Rejected ê°„ Odds Ratio ìµœì í™” |

### 4.3 Hard Negative Mining

![Hard Negative Mining Process](./asset/seed.png)

TeacherëŠ” ì„±ê³µí–ˆìœ¼ë‚˜ StudentëŠ” ì‹¤íŒ¨í•œ ë¬¸í•­(Hard Negative)ì„ ì§‘ì¤‘ì ìœ¼ë¡œ íƒ€ê²ŸíŒ…í•©ë‹ˆë‹¤:

1. Teacherì˜ ì„±ê³µ ì¶”ë¡  ê²½ë¡œ(Golden Path)ì™€ Studentì˜ ì‹¤íŒ¨ ì¶”ë¡  ê²½ë¡œ(Failed Path) ì¶”ì¶œ
2. ë„ë©”ì¸ ë…ë¦½ì ì¸ ë…¼ë¦¬ êµ¬ì¡° íŒ¨í„´ ë¶„ì„
3. ì¶”ì¶œëœ êµ¬ì¡°ë¥¼ ìƒˆë¡œìš´ ë„ë©”ì¸/ë§¥ë½ìœ¼ë¡œ ì „ì´í•˜ì—¬ ì¦ê°• ë°ì´í„° ìƒì„±
4. ORPOë¡œ Student ëª¨ë¸ í•™ìŠµ

### 4.4 Blueprint Prompting Strategy

![alt text](./asset/work.png)

Teacherì—ê²Œ ë‹¨ìˆœíˆ "ë¹„ìŠ·í•œ ë¬¸ì œë¥¼ ë§Œë“¤ì–´ì¤˜"ë¼ê³  ìš”ì²­í•˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤.
**ì„±ê³µí•œ ì¶”ë¡  ê²½ë¡œì™€ ì‹¤íŒ¨í•œ ì¶”ë¡  ê²½ë¡œë¥¼ í•¨ê»˜ ì œê³µ**í•˜ëŠ” **Blueprint Prompting** ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

**Input**

* Golden Reasoning Path (Teacherì˜ ì„±ê³µ ì¶”ë¡ )
* Rejected Reasoning Path (Studentì˜ ì‹¤íŒ¨ ì¶”ë¡ )
* Transfer Target (ìƒˆ ë„ë©”ì¸/ë§¥ë½)

**Output**

* ë™ì¼í•œ ë…¼ë¦¬ êµ¬ì¡°ë¥¼ ìœ ì§€í•œ ìƒˆë¡œìš´ ë¬¸ì œ
* ëª…í™•íˆ êµ¬ë¶„ëœ Chosen / Rejected ì‘ë‹µ ìŒ

ì´ ë°©ì‹ì€ ì •ë‹µ ì—¬ë¶€ê°€ ì•„ë‹ˆë¼
**ì¶”ë¡  ê²½ë¡œì˜ ì •ë ¬ ì—¬ë¶€ë¥¼ ë°ì´í„° í’ˆì§ˆ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ìŠµë‹ˆë‹¤.**

### 4.5 ì¦ê°• ë°ì´í„° ì˜ˆì‹œ

**ì¶”ì¶œëœ ë…¼ë¦¬ êµ¬ì¡°**: `ì •ì±… ëª©ì  â†’ êµ¬ì²´ì  ìˆ˜ë‹¨` ê°„ì˜ **ì¸ê³¼ì„± ì¶”ë¡ **

<table>
<tr>
<td width="50%">

#### Original Seed
**í¥ì„ ëŒ€ì›êµ°ì˜ ì„œì› ì² í ì •ì±…**

```
ë¬¸ì œ: ì²œì—¬ ê³³ì˜ ì„œì›ì„ ì² íí•˜ê³ ...
      (ê°€) ì¸ë¬¼ì´ ì¶”ì§„í•œ ì •ì±…ìœ¼ë¡œ
      ì˜³ì§€ ì•Šì€ ê²ƒì€?

ì„ ì§€:
1. ê²½ë³µê¶ì„ ì¤‘ê±´í•˜ì˜€ë‹¤
2. í˜¸í¬ì œë¥¼ ì‹¤ì‹œí•˜ì˜€ë‹¤
3. ë¹„ë³€ì‚¬ë¥¼ ê°•í™”í•˜ì˜€ë‹¤ [ì˜¤ë‹µ]
4. í†µë¦¬ê¸°ë¬´ì•„ë¬¸ì„ ì„¤ì¹˜í•˜ì˜€ë‹¤
```

**Chosen Reasoning (Teacher)**
```
1. í•µì‹¬ ëª©ì : ì™•ê¶Œ ê°•í™”
2. ìˆ˜ë‹¨ ë¶„ì„:
   - ì„œì› ì² í â†’ ì§€ë°© ì‚¬ë¦¼ ì„¸ë ¥ ì•½í™”
   - ë¹„ë³€ì‚¬ëŠ” ì‹ í•˜ ê¶Œë ¥ ê°•í™” ê¸°êµ¬
3. ë…¼ë¦¬: ì™•ê¶Œ ê°•í™” ì •ì±…ì—ì„œ
   ë¹„ë³€ì‚¬ ê°•í™”ëŠ” ëª¨ìˆœ
â†’ ë‹µ: 3ë²ˆ
```

**Rejected Reasoning (Student)**
```
1. ì„œì› ì² í = ìœ êµ ê°œí˜
2. ì •ì¡°ë„ ìœ êµ ê°œí˜ ì¶”ì§„
3. 4ë²ˆ í†µë¦¬ê¸°ë¬´ì•„ë¬¸ì€ ê·¼ëŒ€ ê¸°êµ¬
4. ì˜¤íŒ: ì •ì¡°ì˜ ì •ì±…ìœ¼ë¡œ ì°©ê°
â†’ ì˜¤ë‹µ: 4ë²ˆ
```

</td>
<td width="50%">

#### Augmented Data
**ê´‘ì¢…ì˜ ë…¸ë¹„ì•ˆê²€ë²•**

```
ë¬¸ì œ: ë…¸ë¹„ë“¤ì„ ì¡°ì‚¬í•˜ì—¬ ì›ë˜
      ì–‘ì¸ì´ì—ˆë˜ ìë“¤ì€ ëª¨ë‘ í•´ë°©...
      ì´ êµ­ì™•ì— ëŒ€í•œ ì„¤ëª…ì€?

ì„ ì§€:
1. ê³¼ê±°ì œë¥¼ ì‹¤ì‹œí•˜ì˜€ë‹¤ [ì •ë‹µ]
2. ì§€ë°©ì— 12ëª©ì„ ì„¤ì¹˜í•˜ì˜€ë‹¤
3. ë…ì„œì‚¼í’ˆê³¼ë¥¼ ì‹¤ì‹œí•˜ì˜€ë‹¤
4. ì²­í•´ì§„ì„ ì„¤ì¹˜í•˜ì˜€ë‹¤
```

**Chosen Reasoning (Aligned)**
```
1. í•µì‹¬ ëª©ì : í˜¸ì¡± ì„¸ë ¥ ê²¬ì œ
2. ìˆ˜ë‹¨ ë¶„ì„:
   - ë…¸ë¹„ì•ˆê²€ë²• â†’ í˜¸ì¡± ê²½ì œë ¥ ì•½í™”
   - ê³¼ê±°ì œ â†’ ì™•ê¶Œ ì§ì† ê´€ë£Œ ì–‘ì„±
3. ë…¼ë¦¬: í˜¸ì¡± ê²¬ì œ ì •ì±…ìœ¼ë¡œ
   ê³¼ê±°ì œê°€ ì¼ì¹˜
â†’ ë‹µ: 1ë²ˆ
```

**Rejected Reasoning (Simulated)**
```
1. ë…¸ë¹„ í•´ë°© = ì§€ë°© ì œë„ ê°œí˜
2. 12ëª© ì„¤ì¹˜ë„ ì§€ë°© ì œë„ ì •ë¹„
3. ì„±ì¢…ê³¼ ê´‘ì¢… ì •ì±… í˜¼ë™
4. ì˜¤íŒ: ìœ ì‚¬ ì‹œëŒ€ ì¸ë¬¼ ì°©ê°
â†’ ì˜¤ë‹µ: 2ë²ˆ
```

</td>
</tr>
</table>

#### ì „ì´ í¬ì¸íŠ¸ ë¶„ì„

| ë¶„ì„ í•­ëª© | ì„¤ëª… |
|-----------|------|
| **ë…¼ë¦¬ êµ¬ì¡° ë³´ì¡´** | "ì •ì±… ëª©ì  â†’ êµ¬ì²´ì  ìˆ˜ë‹¨"ì˜ ì¸ê³¼ì„±ì„ ê²€ì¦í•˜ëŠ” ì¶”ë¡  íŒ¨í„´ì´ ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤ |
| **ì˜¤ë¥˜ íŒ¨í„´ ì¬í˜„** | Studentê°€ "ìœ ì‚¬ ì‹œëŒ€ì˜ ë‹¤ë¥¸ ì¸ë¬¼"ë¡œ í˜¼ë™í•˜ëŠ” ì‹¤ìˆ˜ë¥¼ ìƒˆ ë¬¸ì œì—ì„œë„ ì¬í˜„í•©ë‹ˆë‹¤ |
| **ë‚œì´ë„ ì¼ê´€ì„±** | ë°°ê²½ì§€ì‹ê³¼ í…ìŠ¤íŠ¸ ì¶”ë¡ ì˜ ê· í˜•ì´ ì›ë³¸ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤ |
| **ë„ë©”ì¸ ì „ì´** | ì¡°ì„  í›„ê¸° â†’ ê³ ë ¤ ì‹œëŒ€ë¡œ ì‹œëŒ€ëŠ” ë°”ë€Œì—ˆì§€ë§Œ, "ì™•ê¶Œ ê°•í™”"ë¼ëŠ” ì •ì±… ëª©ì ì˜ ë…¼ë¦¬ëŠ” ë™ì¼í•©ë‹ˆë‹¤ |

---

## 5. ì‹¤í—˜ ê²°ê³¼

### 5.1 Evaluation Setup

**Models**
- Baseline (14B): Qwen3-14B-AWQ
- Baseline (30B): Qwen3-30B-A3B-f8
- Target (ORPO): Qwen3-14B-bnb-4bit-ORPO

**Dataset**
- Upstage ìˆ˜ëŠ¥í˜• ë¬¸ì œ 869ë¬¸ì œ (test set)
- ì´ 869ë¬¸í•­ ì¤‘ `425ê°œ`ì˜ `ìˆ˜ëŠ¥ ê¸°ì¶œë¬¸ì œ`ë§Œ ì‚¬ìš©
- ì •ë‹µ ë¼ë²¨: Gemini-3-Flash + GPT-5.2 ê° 3íšŒ ì¶”ë¡  í›„ ë‹¤ìˆ˜ê²°

### 5.2 Key Result

200ê°œì˜ ORPO í•™ìŠµ ë°ì´í„°ë§Œìœ¼ë¡œ **ì•½ 2ë°° í° 30B ëª¨ë¸ê³¼ ë™ê¸‰ ì´ìƒì˜ ì„±ëŠ¥**ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.

![image.png](./asset/plot_two.png)

| ê³¼ëª© (Subject) | Qwen3-14b-AWQ | Qwen3-30b-A3b-Ins | Qwen3-14b-ORPO | ë¬¸í•­ ìˆ˜ (Support) |
| :--- | :---: | :---: | :---: | :---: |
| êµ­ì–´ | 71.43% | **73.55%** | `73.55%` | 189 |
| ìƒí™œê³¼ ìœ¤ë¦¬ | 71.67% | 71.67% | `75.00%` | 60 |
| ìœ¤ë¦¬ì™€ ì‚¬ìƒ | 70.77% | 67.69% | `73.85%` | 65 |
| ì‚¬íšŒë¬¸í™” | 58.33% | **68.75%** | 64.58% | 48 |
| ì •ì¹˜ì™€ ë²• | 57.14% | **60.32%** | 58.73% | 63 |

> ì‹¤ì œ ëŒ€íšŒ test setì—ì„œëŠ” ORPO ì ìš© í›„ f1-scoreê°€ ì†Œí­ í•˜ë½í–ˆì§€ë§Œ,
> ê°œì„  ëŒ€ìƒì´ì—ˆë˜ ìˆ˜ëŠ¥ ê¸°ì¶œë¬¸ì œ 425ë¬¸í•­ ê¸°ì¤€ìœ¼ë¡œëŠ” ì„±ëŠ¥ì´ ìœ ì˜ë¯¸í•˜ê²Œ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.
> **ë‹¨ 200ê°œì˜ ë°ì´í„°ë§Œìœ¼ë¡œë„ ë„ë©”ì¸ ë§ì¶¤ reasoning alignmentê°€ ê°€ëŠ¥í•¨**ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

### 5.3 Data Distribution Analysis [UMAP Visualization]

![alt text](./asset/output.png)

UMAP ì‹œê°í™”ì—ì„œ Hard Training Dataê°€ ìˆ˜ëŠ¥ ê¸°ì¶œë¬¸í•­ê³¼ ë†’ì€ ì¤‘ì²©ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.

Hard Miningìœ¼ë¡œ êµ¬ì¶•í•œ ë°ì´í„°ê°€ ìˆ˜ëŠ¥ ë¬¸í•­ì˜ ì ì¬ì  ì¶”ë¡  ê³µê°„(Latent Space)ê³¼ ë§¤ìš° ìœ ì‚¬í–ˆê¸° ë•Œë¬¸ì—,
ë‹¨ 200ê°œì˜ Preference Datasetë§Œìœ¼ë¡œë„ íš¨ê³¼ì ì¸ ë„ë©”ì¸ ì •ë ¬ì´ ê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤.

---

## 6. Key Findings

- Hard Negativeë§Œ í•™ìŠµí•˜ëŠ” ê²ƒì´ ì „ì²´ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ íš¨ìœ¨ì ì…ë‹ˆë‹¤
- ë…¼ë¦¬ êµ¬ì¡°ë§Œ ë³´ì¡´í•˜ë©´ ë„ë©”ì¸ì´ ë‹¬ë¼ë„ ì¶”ë¡  íŒ¨í„´ ì „ì´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤
- Blueprint Promptingì´ ë°ì´í„° í’ˆì§ˆì„ ê²°ì •ì ìœ¼ë¡œ ê°œì„ í–ˆìŠµë‹ˆë‹¤
- ORPOëŠ” reasoning alignmentì— ì•ˆì •ì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤

---

## 7. ë¹ ë¥¸ ì‹œì‘

### 7.1 Technical Stack

```yaml
Models:
  Teacher: Gemini-3-Flash
  Student Base: Qwen3-235B
  Student Target: Qwen3-14B

Training:
  Algorithm: ORPO (Odds Ratio Preference Optimization)
  Framework: Unsloth + ğŸ¤— Transformers + bitsandbytes (bnb-4bit)
  Hardware: V100 32GB Ã— 1
  Training Time: ~4 hours

Data:
  Source: KSAT-style questions (Upstage)
  Seed: ~200 Hard Negatives (Teacher âœ“ / Student âœ—)
  Augmentation: Blueprint Prompting + Analogical Prompting

Evaluation:
  Metrics: Accuracy, F1, Subject-wise analysis
```

---

## 8. ì°¸ê³  ìë£Œ

| ë…¼ë¬¸ | ê¸°ì—¬ |
|------|------|
| [ORPO: Monolithic Preference Optimization](https://arxiv.org/abs/2403.07691) | Odds Ratio ê¸°ë°˜ Preference Learning |
| [Qwen Technical Report](https://arxiv.org/abs/2309.16609) | Base ëª¨ë¸ ì•„í‚¤í…ì²˜ |
| [Chain-of-Thought Prompting](https://arxiv.org/abs/2201.11903) | ë‹¨ê³„ì  ì¶”ë¡  ìœ ë„ |
| [Self-Rewarding Language Models](https://arxiv.org/abs/2401.10020) | ìê¸° ê°œì„  í•™ìŠµ êµ¬ì¡° |
| [Analogical Prompting (ICLR 2024)](https://arxiv.org/abs/2310.01714) | ìœ ì¶” ê¸°ë°˜ í”„ë¡¬í”„íŒ… |
| [Blueprint Prompting](https://arxiv.org/abs/2506.08669) | êµ¬ì¡°ì  í”„ë¡¬í”„íŠ¸ ì „ì´ |
| [Hard Negative Sample-Augmented DPO](https://arxiv.org/abs/2512.19728) | Hard Negative ê¸°ë°˜ ì„ í˜¸ í•™ìŠµ |
